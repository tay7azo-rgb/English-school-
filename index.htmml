<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Easy English - Ø±Ù…Ø¶Ø§Ù†ÙŠØ§Øª ØªØ¹Ù„ÙŠÙ…ÙŠØ© Ø°ÙƒÙŠØ©</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
  <style>
    :root {
      --gold: #c19a6b;
      --gold-soft: #e4c49b;
      --brown: #3d2b1f;
      --glass: rgba(255,255,255,0.12);
    }

    body {
      font-family: 'Cairo', sans-serif;
      background: radial-gradient(circle at top, #4b3621 0%, #1a1a1a 45%, #000 100%);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      overflow: hidden;
      color: white;
      position: relative;
    }

    .ramadan-bg {
      position: absolute;
      inset: 0;
      z-index: -1;
      opacity: 0.28;
      pointer-events: none;
    }

    .ornament {
      position: absolute;
      width: 140px;
      height: 140px;
      border: 2px solid var(--gold);
      transform: rotate(45deg);
      animation: float 18s infinite linear;
    }

    .ornament::before {
      content: '';
      position: absolute;
      inset: 12px;
      border: 1px solid var(--gold);
    }

    @keyframes float {
      0% { transform: rotate(0deg) translate(0,0); }
      50% { transform: rotate(180deg) translate(40px,80px); }
      100% { transform: rotate(360deg) translate(0,0); }
    }

    .moon-glow {
      position: absolute;
      top: -80px;
      left: 50%;
      transform: translateX(-50%);
      width: 260px;
      height: 260px;
      border-radius: 50%;
      background: radial-gradient(circle, rgba(255,255,255,0.18), transparent 70%);
      filter: blur(2px);
      pointer-events: none;
    }

    .glass-panel {
      background: var(--glass);
      backdrop-filter: blur(18px);
      -webkit-backdrop-filter: blur(18px);
      border: 1px solid rgba(255,255,255,0.18);
      border-radius: 28px;
      padding: 3rem 2.5rem;
      width: 92%;
      max-width: 760px;
      text-align: center;
      box-shadow: 0 25px 50px rgba(0,0,0,0.6);
      transition: 0.4s;
      position: relative;
    }

    .btn-main {
      background: linear-gradient(to left, var(--gold), #8e6d45);
      padding: 0.9rem 2.4rem;
      border-radius: 999px;
      font-size: 1.3rem;
      font-weight: 800;
      color: white;
      transition: 0.3s;
      box-shadow: 0 4px 15px rgba(193,154,107,0.35);
      border: none;
    }

    .btn-main:hover {
      transform: scale(1.04) translateY(-2px);
      filter: brightness(1.15);
      box-shadow: 0 10px 25px rgba(193,154,107,0.6);
    }

    .hidden-section { display: none; opacity: 0; transform: translateY(20px); }
    .active-section { display: block; opacity: 1; transform: translateY(0); animation: fadeIn 0.6s forwards; }

    @keyframes fadeIn {
      to { opacity: 1; transform: translateY(0); }
    }

    .big-text {
      font-size: 4.4rem;
      font-weight: 900;
      background: linear-gradient(to bottom, #fff, var(--gold));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      transition: 0.3s;
      word-break: break-word;
    }

    .loader {
      width: 55px;
      height: 55px;
      border: 5px solid rgba(255,255,255,0.2);
      border-top-color: var(--gold);
      border-radius: 50%;
      animation: spin 1s infinite linear;
    }

    @keyframes spin { to { transform: rotate(360deg); } }

    .back-btn {
      position: fixed;
      bottom: 18px;
      right: 18px;
      background: linear-gradient(to bottom right, var(--gold), #8e6d45);
      color: #fff;
      padding: 0.7rem 1.4rem;
      border-radius: 999px;
      font-weight: 700;
      font-size: 0.95rem;
      display: flex;
      align-items: center;
      gap: 0.4rem;
      box-shadow: 0 12px 30px rgba(0,0,0,0.6);
      cursor: pointer;
      z-index: 40;
      transform: translateY(120%);
      opacity: 0;
      transition: 0.35s;
    }

    .back-btn.show {
      transform: translateY(0);
      opacity: 1;
    }

    .back-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 18px 40px rgba(0,0,0,0.8);
    }

    /* Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø£Ù†ÙŠÙ…ÙŠØ´Ù† Ø¹Ù†Ø¯ Ø§Ù„Ù‚ÙˆØ§Ø¹Ø¯ */
    .no-anim .ornament {
      animation: none !important;
    }

    /* ØªØ£Ø«ÙŠØ± ØªÙ…Ø²Ù‚ Ø§Ù„ÙˆØ±Ù‚Ø© */
    .page-tear {
      position: fixed;
      inset: 0;
      background: radial-gradient(circle at top, #f5f5f5 0%, #d9d9d9 40%, #b3b3b3 100%);
      z-index: 50;
      pointer-events: none;
      transform-origin: top center;
      animation: tear 1.1s forwards;
    }

    @keyframes tear {
      0% { transform: scaleY(0); opacity: 0; }
      40% { transform: scaleY(1.05); opacity: 1; }
      100% { transform: scaleY(0); opacity: 0; }
    }

    @media (max-width: 640px) {
      .glass-panel {
        padding: 2.2rem 1.6rem;
        border-radius: 22px;
      }
      .big-text {
        font-size: 3rem;
      }
    }
  </style>
</head>

<body>

  <div class="moon-glow"></div>

  <div class="ramadan-bg">
    <div class="ornament" style="top: 8%; left: 8%;"></div>
    <div class="ornament" style="bottom: 10%; right: 10%; animation-delay: -4s;"></div>
    <div class="ornament" style="top: 55%; right: 20%; width: 90px; height: 90px; animation-duration: 14s;"></div>
  </div>

  <div class="absolute top-0 left-0 w-full h-full pointer-events-none opacity-25">
    <div class="absolute top-6 left-10 text-4xl animate-bounce">ğŸ•¯ï¸</div>
    <div class="absolute top-10 right-12 text-3xl animate-pulse">ğŸŒ™</div>
    <div class="absolute bottom-10 left-1/4 text-3xl animate-bounce">ğŸ•¯ï¸</div>
  </div>

  <!-- Ø´Ø§Ø´Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© -->
  <div id="start-screen" class="glass-panel active-section">
    <h1 class="text-5xl font-black mb-4 text-[var(--gold)] tracking-widest">EASY ENGLISH</h1>
    <p class="mb-2 text-sm opacity-70">ØªØ¹Ù„Ù‘Ù… Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© Ø¨Ù‡Ø¯ÙˆØ¡â€¦ Ø­Ø±ÙÙ‹Ø§ØŒ ØµÙˆØªÙ‹Ø§ØŒ ÙƒÙ„Ù…Ø©Ù‹ ÙˆØ¬Ù…Ù„Ø©Ù‹</p>
    <p class="mb-8 text-xs opacity-60">ØµÙØ­Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø· â€¢ Ø¨Ø¯ÙˆÙ† Ø¥Ù†ØªØ±Ù†Øª â€¢ Ø£Ø¬ÙˆØ§Ø¡ Ø±Ù…Ø¶Ø§Ù†ÙŠØ©</p>
    <button onclick="goToLoading()" class="btn-main">START</button>
  </div>

  <!-- Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ -->
  <div id="loading-screen" class="glass-panel hidden-section">
    <div class="flex flex-col items-center">
      <div class="loader mb-6"></div>
      <h2 class="text-3xl font-bold tracking-widest text-[var(--gold)] mb-2">ØªØ­Ù…ÙŠÙ„</h2>
      <p class="text-sm opacity-70">ÙŠØªÙ… ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ø­Ø±ÙˆÙ ÙˆØ§Ù„Ø£ØµÙˆØ§Øª ÙˆØ§Ù„ÙƒÙ„Ù…Ø§Øª ÙˆØ§Ù„Ø¬Ù…Ù„â€¦</p>
    </div>
  </div>

  <!-- Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
  <div id="main-menu" class="glass-panel hidden-section">
    <h2 class="text-3xl font-bold mb-6 border-b border-[var(--gold)] pb-3">Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</h2>
    <p class="text-sm opacity-70 mb-6">Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø°ÙŠ ØªØ±ÙŠØ¯ Ø£Ù† ÙŠØ¨Ø¯Ø£ Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù…Ù†Ù‡:</p>

    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-6">
      <button onclick="startLearning('abc')" class="btn-main w-full rounded-xl text-lg">Ù‚Ø³Ù… Ø§Ù„Ø­Ø±ÙˆÙ (ABC)</button>
      <button onclick="startLearning('phonics')" class="btn-main w-full rounded-xl text-lg">Ù‚Ø³Ù… Ø§Ù„Ø£ØµÙˆØ§Øª (PHONICS)</button>
      <button onclick="startLearning('words')" class="btn-main w-full rounded-xl text-lg">Ù‚Ø³Ù… Ø§Ù„ÙƒÙ„Ù…Ø§Øª (WORDS)</button>
      <button onclick="startLearning('sentences')" class="btn-main w-full rounded-xl text-lg">Ù‚Ø³Ù… Ø§Ù„Ø¬Ù…Ù„ (SENTENCES)</button>
    </div>

    <div class="mb-6">
      <button onclick="openGrammar()" class="btn-main w-full rounded-xl text-lg bg-gradient-to-r from-[var(--gold)] to-[#d4af37]">
        Ù‚ÙˆØ§Ø¹Ø¯ (GRAMMAR)
      </button>
    </div>

    <!-- Ù‚Ø³Ù… Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª -->
    <div class="mt-6 pt-4 border-t border-white/10">
      <div class="mb-4">
        <div class="text-2xl sm:text-3xl font-black text-[var(--gold)] drop-shadow-md">
          ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¨ÙˆØ§Ø³Ø·Ø© Ø¬Ø§Ø¨Ø± Ø®Ø¨Ø±Ø§Ù†ÙŠ
        </div>
        <div class="mt-2 inline-block px-4 py-1 rounded-full bg-white/10 text-sm sm:text-base text-[var(--gold-soft)]">
          Ø£ÙˆÙ„ Ù…ØªÙˆØ³Ø· / Ø¨
        </div>
      </div>

      <div class="mt-4">
        <div class="text-2xl sm:text-3xl font-black text-[var(--gold)] drop-shadow-md">
          ÙˆØªÙ…Øª Ù…Ø³Ø§Ø¹Ø¯ØªÙ‡ Ø¨ÙˆØ§Ø³Ø·Ø© Ø³Ø§Ù…Ø± Ø¹Ø³ÙŠØ±ÙŠ
        </div>
        <div class="mt-2 inline-block px-4 py-1 rounded-full bg-gradient-to-r from-[var(--gold)]/20 to-transparent text-sm sm:text-base text-[var(--gold-soft)]">
          Ø£ÙˆÙ„ Ù…ØªÙˆØ³Ø· / Ø¨
        </div>
      </div>
    </div>
  </div>

  <!-- Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ØªØ¹Ù„Ù… Ø§Ù„Ø¹Ø§Ù…Ø© -->
  <div id="learning-area" class="glass-panel hidden-section">
    <div class="mb-4 text-xs opacity-70 flex justify-between">
      <span id="mode-label">ÙˆØ¶Ø¹: Ø§Ù„Ø­Ø±ÙˆÙ</span>
      <span id="counter-label">1 / 26</span>
    </div>

    <div id="content-box" class="mt-2">
      <div id="display-text" class="big-text">A</div>
      <div id="sub-text" class="text-2xl text-gray-200 mt-3">Ø£ÙŠÙ‡</div>
    </div>

    <div class="mt-8 flex flex-col gap-3 items-center text-sm">
      <button id="toggle-btn"
              class="px-6 py-2 rounded-full border border-[var(--gold-soft)] text-[var(--gold-soft)] hover:bg-[var(--gold-soft)] hover:text-black transition flex items-center gap-2">
        <span id="toggle-icon">â¸</span>
        <span id="toggle-text">Ø¥ÙŠÙ‚Ø§Ù Ù…Ø¤Ù‚Øª</span>
      </button>

      <button id="smart-cycle-btn"
              class="px-6 py-2 rounded-full border border-white/20 text-white/80 hover:bg-white/10 transition text-xs">
        ØªÙØ¹ÙŠÙ„ / Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØªÙ†Ù‚Ù„ Ø§Ù„Ø°ÙƒÙŠ Ø¨ÙŠÙ† Ø§Ù„Ø£Ù‚Ø³Ø§Ù…
      </button>

      <span class="opacity-60 text-center text-xs sm:text-sm">
        Ø§Ù„Ø¹Ø±Ø¶ ØªÙ„Ù‚Ø§Ø¦ÙŠØŒ ÙŠØªÙƒÙŠÙ‘Ù Ù…Ø¹ Ø·ÙˆÙ„ Ø§Ù„ÙƒÙ„Ù…Ø© Ø£Ùˆ Ø§Ù„Ø¬Ù…Ù„Ø©ØŒ ÙˆÙŠØªÙƒØ±Ø± Ù…Ù† Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© Ø¨Ø¹Ø¯ Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡
      </span>
    </div>
  </div>

  <!-- Ø´Ø§Ø´Ø© Ø§Ø®ØªÙŠØ§Ø± Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù‚ÙˆØ§Ø¹Ø¯ -->
  <div id="grammar-levels" class="glass-panel hidden-section">
    <h2 class="text-3xl font-bold mb-4 text-[var(--gold)]">Ù‚Ø³Ù… Ø§Ù„Ù‚ÙˆØ§Ø¹Ø¯ (GRAMMAR)</h2>
    <p class="text-sm opacity-70 mb-6">
      Ø§Ø®ØªØ± Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨ØŒ ÙˆØ³ÙŠØ¨Ø¯Ø£ Ø´Ø±Ø­ Ø§Ù„Ù‚ÙˆØ§Ø¹Ø¯ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ù…Ø¹ Ø£Ù…Ø«Ù„Ø© ÙˆØ§Ø¶Ø­Ø© Ø¨Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© ÙˆØ§Ù„Ø¹Ø±Ø¨ÙŠØ©.
    </p>

    <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-6">
      <button onclick="startGrammar('beginner')" class="btn-main w-full rounded-xl text-lg bg-gradient-to-r from-green-500 to-emerald-600">
        Ù…Ø¨ØªØ¯Ø¦
      </button>
      <button onclick="startGrammar('intermediate')" class="btn-main w-full rounded-xl text-lg bg-gradient-to-r from-yellow-500 to-amber-600">
        Ù…ØªÙˆØ³Ø·
      </button>
      <button onclick="startGrammar('advanced')" class="btn-main w-full rounded-xl text-lg bg-gradient-to-r from-red-500 to-rose-600">
        ØµØ¹Ø¨
      </button>
    </div>

    <button onclick="closeGrammar()" class="text-xs opacity-70 hover:opacity-100 underline">
      Ø§Ù„Ø¹ÙˆØ¯Ø© Ø¥Ù„Ù‰ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
    </button>
  </div>

  <!-- Ø´Ø§Ø´Ø© Ø´Ø±Ø­ Ø§Ù„Ù‚ÙˆØ§Ø¹Ø¯ -->
  <div id="grammar-learning" class="glass-panel hidden-section">
    <div class="mb-3 text-xs opacity-70 flex justify-between">
      <span id="grammar-level-label">Ù‚ÙˆØ§Ø¹Ø¯: Ù…Ø¨ØªØ¯Ø¦</span>
      <span id="grammar-counter-label">1 / 10</span>
    </div>

    <div class="mt-2">
      <div id="grammar-title" class="text-3xl font-black text-[var(--gold)] mb-3">
        He / She / It
      </div>
      <div id="grammar-en" class="text-xl mb-2">
        He is a boy. She is a girl. It is a cat.
      </div>
      <div id="grammar-ar" class="text-sm text-gray-200 leading-relaxed">
        Ù†Ø³ØªØ®Ø¯Ù… He Ù…Ø¹ Ø§Ù„Ù…Ø°ÙƒØ± Ø§Ù„Ù…ÙØ±Ø¯ØŒ She Ù…Ø¹ Ø§Ù„Ù…Ø¤Ù†Ø« Ø§Ù„Ù…ÙØ±Ø¯ØŒ Ùˆ It Ù…Ø¹ Ø§Ù„Ø£Ø´ÙŠØ§Ø¡ Ø£Ùˆ Ø§Ù„Ø­ÙŠÙˆØ§Ù†Ø§Øª.
      </div>
    </div>

    <div class="mt-6 flex flex-col gap-3 items-center text-sm">
      <button id="grammar-toggle-btn"
              class="px-6 py-2 rounded-full border border-[var(--gold-soft)] text-[var(--gold-soft)] hover:bg-[var(--gold-soft)] hover:text-black transition flex items-center gap-2">
        <span id="grammar-toggle-icon">â¸</span>
        <span id="grammar-toggle-text">Ø¥ÙŠÙ‚Ø§Ù Ù…Ø¤Ù‚Øª</span>
      </button>

      <button onclick="backToGrammarLevels()"
              class="text-xs opacity-70 hover:opacity-100 underline">
        Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø³ØªÙˆÙ‰
      </button>

      <span class="opacity-60 text-center text-xs sm:text-sm">
        Ø§Ù„Ø´Ø±Ø­ ÙŠØªØ­Ø±Ùƒ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ø¨ÙŠÙ† Ù†Ù‚Ø§Ø· Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø© Ù…Ø¹ Ø£Ù…Ø«Ù„Ø© Ù…ØªÙ†ÙˆØ¹Ø©.
      </span>
    </div>
  </div>

  <!-- Ø²Ø± Ø§Ù„Ø¹ÙˆØ¯Ø© Ø§Ù„Ø¹Ø§Ø¦Ù… -->
  <button id="back-btn" class="back-btn" onclick="returnToMenu()">
    <span class="text-xl">ğŸŒ™</span>
    <span>Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
  </button>

  <!-- Ø·Ø¨Ù‚Ø© ØªÙ…Ø²Ù‚ Ø§Ù„ÙˆØ±Ù‚Ø© (ØªÙØ¶Ø§Ù Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹) -->

  <script>
    /* ============================
       Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø±ÙˆÙ ÙˆØ§Ù„Ø£ØµÙˆØ§Øª ÙˆØ§Ù„ÙƒÙ„Ù…Ø§Øª
       ============================ */

    const letters = [
      {en:'A', ar:'Ø£ÙŠÙ‡'}, {en:'B', ar:'Ø¨ÙŠ'}, {en:'C', ar:'Ø³ÙŠ'}, {en:'D', ar:'Ø¯ÙŠ'}, {en:'E', ar:'Ø¥ÙŠ'},
      {en:'F', ar:'Ø¥Ù'}, {en:'G', ar:'Ø¬ÙŠ'}, {en:'H', ar:'Ø¥ØªØ´'}, {en:'I', ar:'Ø¢ÙŠ'}, {en:'J', ar:'Ø¬Ø§ÙŠ'},
      {en:'K', ar:'ÙƒÙŠ'}, {en:'L', ar:'Ø¥Ù„'}, {en:'M', ar:'Ø¥Ù…'}, {en:'N', ar:'Ø¥Ù†'}, {en:'O', ar:'Ø£Ùˆ'},
      {en:'P', ar:'Ø¨ÙŠ'}, {en:'Q', ar:'ÙƒÙŠÙˆ'}, {en:'R', ar:'Ø¢Ø±'}, {en:'S', ar:'Ø¥Ø³'}, {en:'T', ar:'ØªÙŠ'},
      {en:'U', ar:'ÙŠÙˆ'}, {en:'V', ar:'ÙÙŠ'}, {en:'W', ar:'Ø¯Ø¨Ù„ÙŠÙˆ'}, {en:'X', ar:'Ø¥ÙƒØ³'}, {en:'Y', ar:'ÙˆØ§ÙŠ'},
      {en:'Z', ar:'Ø²Ø¯'}
    ];

    const phonics = [
      {en:'SH', ar:'Ø´'}, {en:'CH', ar:'ØªØ´'}, {en:'TH', ar:'Ø« / Ø°'}, {en:'PH', ar:'Ù'}, {en:'TION', ar:'Ø´Ù†'},
      {en:'OO', ar:'Ø£Ùˆ'}, {en:'EA', ar:'Ø¥ÙŠ'}, {en:'OU', ar:'Ø£Ùˆ'}, {en:'AI', ar:'Ø¢ÙŠ'}, {en:'OI', ar:'Ø£ÙˆÙŠ'},
      {en:'NG', ar:'Ù†Øº'}, {en:'AR', ar:'Ø¢Ø±'}, {en:'ER', ar:'Ø¥Ø±'}, {en:'OR', ar:'Ø£ÙˆØ±'}, {en:'UR', ar:'Ø£Ø±'}
    ];

    const nouns = [
      {en:'book', ar:'ÙƒØªØ§Ø¨'}, {en:'phone', ar:'Ù‡Ø§ØªÙ'}, {en:'car', ar:'Ø³ÙŠØ§Ø±Ø©'}, {en:'door', ar:'Ø¨Ø§Ø¨'},
      {en:'window', ar:'Ù†Ø§ÙØ°Ø©'}, {en:'table', ar:'Ø·Ø§ÙˆÙ„Ø©'}, {en:'chair', ar:'ÙƒØ±Ø³ÙŠ'}, {en:'bag', ar:'Ø­Ù‚ÙŠØ¨Ø©'},
      {en:'key', ar:'Ù…ÙØªØ§Ø­'}, {en:'bottle', ar:'Ø²Ø¬Ø§Ø¬Ø©'}, {en:'pen', ar:'Ù‚Ù„Ù…'}, {en:'paper', ar:'ÙˆØ±Ù‚Ø©'},
      {en:'room', ar:'ØºØ±ÙØ©'}, {en:'light', ar:'Ø¶ÙˆØ¡'}, {en:'clock', ar:'Ø³Ø§Ø¹Ø©'}, {en:'computer', ar:'Ø­Ø§Ø³ÙˆØ¨'},
      {en:'tv', ar:'ØªÙ„ÙØ§Ø²'}, {en:'cup', ar:'ÙƒÙˆØ¨'}, {en:'plate', ar:'ØµØ­Ù†'}, {en:'bed', ar:'Ø³Ø±ÙŠØ±'},
      {en:'pillow', ar:'ÙˆØ³Ø§Ø¯Ø©'}, {en:'blanket', ar:'Ø¨Ø·Ø§Ù†ÙŠØ©'}, {en:'shoes', ar:'Ø­Ø°Ø§Ø¡'}, {en:'shirt', ar:'Ù‚Ù…ÙŠØµ'},
      {en:'jacket', ar:'Ø³ØªØ±Ø©'}, {en:'hat', ar:'Ù‚Ø¨Ø¹Ø©'}, {en:'wallet', ar:'Ù…Ø­ÙØ¸Ø©'}, {en:'watch', ar:'Ø³Ø§Ø¹Ø© ÙŠØ¯'},
      {en:'glasses', ar:'Ù†Ø¸Ø§Ø±Ø©'}
    ];

    const places = [
      {en:'school', ar:'Ù…Ø¯Ø±Ø³Ø©'}, {en:'city', ar:'Ù…Ø¯ÙŠÙ†Ø©'}, {en:'home', ar:'Ù…Ù†Ø²Ù„'}, {en:'market', ar:'Ø³ÙˆÙ‚'},
      {en:'hospital', ar:'Ù…Ø³ØªØ´ÙÙ‰'}, {en:'airport', ar:'Ù…Ø·Ø§Ø±'}, {en:'park', ar:'Ø­Ø¯ÙŠÙ‚Ø©'}, {en:'mosque', ar:'Ù…Ø³Ø¬Ø¯'},
      {en:'street', ar:'Ø´Ø§Ø±Ø¹'}, {en:'restaurant', ar:'Ù…Ø·Ø¹Ù…'}, {en:'office', ar:'Ù…ÙƒØªØ¨'}, {en:'kitchen', ar:'Ù…Ø·Ø¨Ø®'},
      {en:'bathroom', ar:'Ø­Ù…Ø§Ù…'}, {en:'garden', ar:'Ø­Ø¯ÙŠÙ‚Ø©'}, {en:'supermarket', ar:'Ø³ÙˆØ¨Ø±Ù…Ø§Ø±ÙƒØª'}
    ];

    const verbs = [
      {en:'run', ar:'ÙŠØ¬Ø±ÙŠ'}, {en:'eat', ar:'ÙŠØ£ÙƒÙ„'}, {en:'drink', ar:'ÙŠØ´Ø±Ø¨'}, {en:'sleep', ar:'ÙŠÙ†Ø§Ù…'},
      {en:'read', ar:'ÙŠÙ‚Ø±Ø£'}, {en:'write', ar:'ÙŠÙƒØªØ¨'}, {en:'walk', ar:'ÙŠÙ…Ø´ÙŠ'}, {en:'drive', ar:'ÙŠÙ‚ÙˆØ¯'},
      {en:'open', ar:'ÙŠÙØªØ­'}, {en:'close', ar:'ÙŠØºÙ„Ù‚'}, {en:'speak', ar:'ÙŠØªØ­Ø¯Ø«'}, {en:'listen', ar:'ÙŠØ³ØªÙ…Ø¹'},
      {en:'study', ar:'ÙŠØ¯Ø±Ø³'}, {en:'work', ar:'ÙŠØ¹Ù…Ù„'}, {en:'play', ar:'ÙŠÙ„Ø¹Ø¨'}, {en:'help', ar:'ÙŠØ³Ø§Ø¹Ø¯'},
      {en:'cook', ar:'ÙŠØ·Ø¨Ø®'}, {en:'clean', ar:'ÙŠÙ†Ø¸Ù'}, {en:'wait', ar:'ÙŠÙ†ØªØ¸Ø±'}, {en:'call', ar:'ÙŠØªØµÙ„'},
      {en:'visit', ar:'ÙŠØ²ÙˆØ±'}, {en:'learn', ar:'ÙŠØªØ¹Ù„Ù…'}, {en:'teach', ar:'ÙŠØ¹Ù„Ù‘Ù…'}, {en:'buy', ar:'ÙŠØ´ØªØ±ÙŠ'},
      {en:'sell', ar:'ÙŠØ¨ÙŠØ¹'}, {en:'smile', ar:'ÙŠØ¨ØªØ³Ù…'}, {en:'cry', ar:'ÙŠØ¨ÙƒÙŠ'}, {en:'think', ar:'ÙŠÙÙƒØ±'}
    ];

    const adjectives = [
      {en:'fast', ar:'Ø³Ø±ÙŠØ¹'}, {en:'slow', ar:'Ø¨Ø·ÙŠØ¡'}, {en:'happy', ar:'Ø³Ø¹ÙŠØ¯'}, {en:'sad', ar:'Ø­Ø²ÙŠÙ†'},
      {en:'strong', ar:'Ù‚ÙˆÙŠ'}, {en:'weak', ar:'Ø¶Ø¹ÙŠÙ'}, {en:'big', ar:'ÙƒØ¨ÙŠØ±'}, {en:'small', ar:'ØµØºÙŠØ±'},
      {en:'hot', ar:'Ø­Ø§Ø±'}, {en:'cold', ar:'Ø¨Ø§Ø±Ø¯'}, {en:'beautiful', ar:'Ø¬Ù…ÙŠÙ„'}, {en:'ugly', ar:'Ù‚Ø¨ÙŠØ­'},
      {en:'easy', ar:'Ø³Ù‡Ù„'}, {en:'difficult', ar:'ØµØ¹Ø¨'}, {en:'new', ar:'Ø¬Ø¯ÙŠØ¯'}, {en:'old', ar:'Ù‚Ø¯ÙŠÙ…'},
      {en:'clean', ar:'Ù†Ø¸ÙŠÙ'}, {en:'dirty', ar:'Ù…ØªØ³Ø®'}, {en:'rich', ar:'ØºÙ†ÙŠ'}, {en:'poor', ar:'ÙÙ‚ÙŠØ±'}
    ];

    const natureWords = [
      {en:'sun', ar:'Ø´Ù…Ø³'}, {en:'moon', ar:'Ù‚Ù…Ø±'}, {en:'star', ar:'Ù†Ø¬Ù…Ø©'}, {en:'sky', ar:'Ø³Ù…Ø§Ø¡'},
      {en:'rain', ar:'Ù…Ø·Ø±'}, {en:'snow', ar:'Ø«Ù„Ø¬'}, {en:'wind', ar:'Ø±ÙŠØ§Ø­'}, {en:'fire', ar:'Ù†Ø§Ø±'},
      {en:'earth', ar:'Ø£Ø±Ø¶'}, {en:'tree', ar:'Ø´Ø¬Ø±Ø©'}, {en:'flower', ar:'Ø²Ù‡Ø±Ø©'}, {en:'river', ar:'Ù†Ù‡Ø±'},
      {en:'sea', ar:'Ø¨Ø­Ø±'}, {en:'mountain', ar:'Ø¬Ø¨Ù„'}
    ];

    const animals = [
      {en:'cat', ar:'Ù‚Ø·Ø©'}, {en:'dog', ar:'ÙƒÙ„Ø¨'}, {en:'bird', ar:'Ø·Ø§Ø¦Ø±'}, {en:'fish', ar:'Ø³Ù…ÙƒØ©'},
      {en:'horse', ar:'Ø­ØµØ§Ù†'}, {en:'lion', ar:'Ø£Ø³Ø¯'}, {en:'tiger', ar:'Ù†Ù…Ø±'}, {en:'camel', ar:'Ø¬Ù…Ù„'},
      {en:'sheep', ar:'Ø®Ø±ÙˆÙ'}, {en:'cow', ar:'Ø¨Ù‚Ø±Ø©'}, {en:'goat', ar:'Ù…Ø§Ø¹Ø²'}, {en:'chicken', ar:'Ø¯Ø¬Ø§Ø¬Ø©'}
    ];

    const feelings = [
      {en:'love', ar:'Ø­Ø¨'}, {en:'fear', ar:'Ø®ÙˆÙ'}, {en:'hope', ar:'Ø£Ù…Ù„'}, {en:'anger', ar:'ØºØ¶Ø¨'},
      {en:'peace', ar:'Ø³Ù„Ø§Ù…'}, {en:'joy', ar:'ÙØ±Ø­'}, {en:'worry', ar:'Ù‚Ù„Ù‚'}, {en:'pride', ar:'ÙØ®Ø±'}
    ];

    const colors = [
      {en:'red', ar:'Ø£Ø­Ù…Ø±'}, {en:'blue', ar:'Ø£Ø²Ø±Ù‚'}, {en:'green', ar:'Ø£Ø®Ø¶Ø±'}, {en:'black', ar:'Ø£Ø³ÙˆØ¯'},
      {en:'white', ar:'Ø£Ø¨ÙŠØ¶'}, {en:'yellow', ar:'Ø£ØµÙØ±'}, {en:'purple', ar:'Ø¨Ù†ÙØ³Ø¬ÙŠ'}, {en:'brown', ar:'Ø¨Ù†ÙŠ'},
      {en:'orange', ar:'Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ'}, {en:'pink', ar:'ÙˆØ±Ø¯ÙŠ'}
    ];

    function capitalize(str) {
      return str.charAt(0).toUpperCase() + str.slice(1);
    }

    const words = [
      ...nouns, ...places, ...verbs, ...adjectives,
      ...natureWords, ...animals, ...feelings, ...colors
    ].map(w => ({ en: capitalize(w.en), ar: w.ar }));

    /* ============================
       Ø¬Ù…Ù„ Ù…Ù†Ø·Ù‚ÙŠØ© (Ø£ÙƒØ«Ø± Ù…Ù† 1000)
       ============================ */

    const simpleSubjects = [
      {en:'I', ar:'Ø£Ù†Ø§'},
      {en:'You', ar:'Ø£Ù†Øª'},
      {en:'He', ar:'Ù‡Ùˆ'},
      {en:'She', ar:'Ù‡ÙŠ'},
      {en:'We', ar:'Ù†Ø­Ù†'},
      {en:'They', ar:'Ù‡Ù…'}
    ];

    const timePhrases = [
      {en:'today', ar:'Ø§Ù„ÙŠÙˆÙ…'},
      {en:'every day', ar:'ÙƒÙ„ ÙŠÙˆÙ…'},
      {en:'at night', ar:'ÙÙŠ Ø§Ù„Ù„ÙŠÙ„'},
      {en:'in the morning', ar:'ÙÙŠ Ø§Ù„ØµØ¨Ø§Ø­'},
      {en:'in Ramadan', ar:'ÙÙŠ Ø±Ù…Ø¶Ø§Ù†'},
      {en:'on Friday', ar:'ÙŠÙˆÙ… Ø§Ù„Ø¬Ù…Ø¹Ø©'}
    ];

    const sentencePatterns = [
      {
        en: (s, v, o) => `${s.en} ${v.en} ${o.en}.`,
        ar: (s, v, o) => `${s.ar} ${v.ar} ${o.ar}.`
      },
      {
        en: (s, v, o, t) => `${s.en} ${v.en} ${o.en} ${t.en}.`,
        ar: (s, v, o, t) => `${s.ar} ${v.ar} ${o.ar} ${t.ar}.`
      },
      {
        en: (s, v, p) => `${s.en} ${v.en} at the ${p.en}.`,
        ar: (s, v, p) => `${s.ar} ${v.ar} ÙÙŠ Ø§Ù„Ù€${p.ar}.`
      },
      {
        en: (s, v, n) => `${s.en} like this ${n.en}.`,
        ar: (s, v, n) => `${s.ar} ÙŠØ­Ø¨ Ù‡Ø°Ø§ Ø§Ù„Ù€${n.ar}.`
      }
    ];

    const sentences = [];

    for (let i = 0; i < simpleSubjects.length; i++) {
      for (let j = 0; j < verbs.length; j++) {
        for (let k = 0; k < nouns.length; k++) {
          if (sentences.length > 1100) break;
          const s = simpleSubjects[i];
          const v = verbs[j];
          const n = nouns[k];
          const t = timePhrases[(i + j + k) % timePhrases.length];
          const p = places[(i + j + k) % places.length];
          const pattern = sentencePatterns[(i + j + k) % sentencePatterns.length];

          const en = pattern.en(s, v, n, t, p);
          const ar = pattern.ar(s, v, n, t, p);

          sentences.push({ en, ar });
        }
        if (sentences.length > 1100) break;
      }
      if (sentences.length > 1100) break;
    }

    const data = {
      abc: letters,
      phonics: phonics,
      words: words,
      sentences: sentences
    };

    /* ============================
       Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚ÙˆØ§Ø¹Ø¯ (Grammar)
       ============================ */

    const grammarData = {
      beginner: [
        {
          title: 'He / She / It',
          en: 'He is a boy. She is a girl. It is a cat.',
          ar: 'Ù†Ø³ØªØ®Ø¯Ù… He Ù…Ø¹ Ø§Ù„Ù…Ø°ÙƒØ± Ø§Ù„Ù…ÙØ±Ø¯ØŒ She Ù…Ø¹ Ø§Ù„Ù…Ø¤Ù†Ø« Ø§Ù„Ù…ÙØ±Ø¯ØŒ Ùˆ It Ù…Ø¹ Ø§Ù„Ø£Ø´ÙŠØ§Ø¡ Ø£Ùˆ Ø§Ù„Ø­ÙŠÙˆØ§Ù†Ø§Øª.'
        },
        {
          title: 'I / You / We / They',
          en: 'I am a student. You are my friend. We are in class. They are happy.',
          ar: 'I Ù…Ø¹ Ø§Ù„Ù…ØªÙƒÙ„Ù…ØŒ You Ù…Ø¹ Ø§Ù„Ù…Ø®Ø§Ø·Ø¨ØŒ We Ù…Ø¹ Ø§Ù„Ø¬Ù…Ø§Ø¹Ø© Ø§Ù„ØªÙŠ ØªØ¶Ù… Ø§Ù„Ù…ØªÙƒÙ„Ù…ØŒ They Ù…Ø¹ Ø§Ù„ØºØ§Ø¦Ø¨ÙŠÙ† (Ø¬Ù…Ø¹).'
        },
        {
          title: 'Verb to be (am / is / are)',
          en: 'I am, He is, She is, It is, We are, You are, They are.',
          ar: 'am ÙŠØ£ØªÙŠ Ù…Ø¹ I ÙÙ‚Ø·ØŒ is Ù…Ø¹ Ø§Ù„Ù…ÙØ±Ø¯ØŒ are Ù…Ø¹ Ø§Ù„Ø¬Ù…Ø¹ Ùˆ You.'
        },
        {
          title: 'This / That',
          en: 'This is a book. That is a car.',
          ar: 'This Ù„Ø´ÙŠØ¡ Ù‚Ø±ÙŠØ¨ØŒ That Ù„Ø´ÙŠØ¡ Ø¨Ø¹ÙŠØ¯.'
        },
        {
          title: 'These / Those',
          en: 'These are books. Those are cars.',
          ar: 'These Ù„Ù„Ø¬Ù…Ø¹ Ø§Ù„Ù‚Ø±ÙŠØ¨ØŒ Those Ù„Ù„Ø¬Ù…Ø¹ Ø§Ù„Ø¨Ø¹ÙŠØ¯.'
        }
      ],
      intermediate: [
        {
          title: 'Present Simple',
          en: 'He plays football every day. They go to school on Monday.',
          ar: 'Ù†Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù…Ø¶Ø§Ø±Ø¹ Ø§Ù„Ø¨Ø³ÙŠØ· Ù„Ù„Ø£ÙØ¹Ø§Ù„ Ø§Ù„Ù…ØªÙƒØ±Ø±Ø© ÙˆØ§Ù„Ø­Ù‚Ø§Ø¦Ù‚ Ø§Ù„Ø¹Ø§Ù…Ø©ØŒ Ù…Ø¹ Ø¥Ø¶Ø§ÙØ© s Ù„Ù„ÙØ¹Ù„ Ù…Ø¹ He / She / It.'
        },
        {
          title: 'Adverbs of Frequency',
          en: 'I always wake up early. She sometimes drinks tea.',
          ar: 'ÙƒÙ„Ù…Ø§Øª Ù…Ø«Ù„ always, usually, sometimes, never ØªØ¹Ø¨Ù‘Ø± Ø¹Ù† Ø¹Ø¯Ø¯ ØªÙƒØ±Ø§Ø± Ø§Ù„ÙØ¹Ù„.'
        },
        {
          title: 'Countable / Uncountable',
          en: 'I have two books. I drink some water.',
          ar: 'Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù…Ø¹Ø¯ÙˆØ¯Ø© ÙŠÙ…ÙƒÙ† Ø¹Ø¯Ù‘Ù‡Ø§ (book/books)ØŒ ÙˆØºÙŠØ± Ø§Ù„Ù…Ø¹Ø¯ÙˆØ¯Ø© Ù…Ø«Ù„ water, rice Ù„Ø§ ØªÙØ¹Ø¯ Ù…Ø¨Ø§Ø´Ø±Ø©.'
        },
        {
          title: 'There is / There are',
          en: 'There is a cat in the room. There are three chairs.',
          ar: 'There is Ù„Ù„Ù…ÙØ±Ø¯ØŒ There are Ù„Ù„Ø¬Ù…Ø¹ØŒ ÙˆØªØ³ØªØ®Ø¯Ù… Ù„ÙˆØµÙ ÙˆØ¬ÙˆØ¯ Ø´ÙŠØ¡ ÙÙŠ Ù…ÙƒØ§Ù†.'
        },
        {
          title: 'Can / Can\'t',
          en: 'I can swim. She can\'t drive.',
          ar: 'Can Ù„Ù„ØªØ¹Ø¨ÙŠØ± Ø¹Ù† Ø§Ù„Ù‚Ø¯Ø±Ø©ØŒ Ùˆ Can\'t Ù„Ø¹Ø¯Ù… Ø§Ù„Ù‚Ø¯Ø±Ø©.'
        }
      ],
      advanced: [
        {
          title: 'Present Perfect',
          en: 'I have finished my homework. She has visited Makkah.',
          ar: 'Ù†Ø³ØªØ®Ø¯Ù…Ù‡ Ù„Ø­Ø¯Ø« Ø§Ù†ØªÙ‡Ù‰ ÙˆÙ„Ù‡ Ø¹Ù„Ø§Ù‚Ø© Ø¨Ø§Ù„Ø­Ø§Ø¶Ø±ØŒ Ù…Ø¹ Have/Has + Ø§Ù„ØªØµØ±ÙŠÙ Ø§Ù„Ø«Ø§Ù„Ø« Ù„Ù„ÙØ¹Ù„.'
        },
        {
          title: 'Past Continuous',
          en: 'I was reading when he called.',
          ar: 'Ù†Ø³ØªØ®Ø¯Ù…Ù‡ Ù„ÙˆØµÙ ÙØ¹Ù„ ÙƒØ§Ù† Ù…Ø³ØªÙ…Ø±Ù‹Ø§ ÙÙŠ Ø§Ù„Ù…Ø§Ø¶ÙŠ Ø¹Ù†Ø¯Ù…Ø§ Ø­Ø¯Ø« ÙØ¹Ù„ Ø¢Ø®Ø±.'
        },
        {
          title: 'First Conditional',
          en: 'If you study, you will pass.',
          ar: 'Ù†Ø³ØªØ®Ø¯Ù…Ù‡ Ù„Ù„ØªØ¹Ø¨ÙŠØ± Ø¹Ù† Ø§Ø­ØªÙ…Ø§Ù„ Ø­Ù‚ÙŠÙ‚ÙŠ ÙÙŠ Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„: If + present, will + base verb.'
        },
        {
          title: 'Comparatives / Superlatives',
          en: 'Ali is taller than Omar. Sara is the smartest student.',
          ar: 'taller Ù„Ù„Ù…Ù‚Ø§Ø±Ù†Ø© Ø¨ÙŠÙ† Ø§Ø«Ù†ÙŠÙ†ØŒ the smartest Ù„Ù„Ø£ÙØ¶Ù„ Ø¨ÙŠÙ† Ù…Ø¬Ù…ÙˆØ¹Ø©.'
        },
        {
          title: 'Passive Voice (Basic)',
          en: 'The door is opened. The food is cooked.',
          ar: 'Ù†Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù…Ø¨Ù†ÙŠ Ù„Ù„Ù…Ø¬Ù‡ÙˆÙ„ Ø¹Ù†Ø¯Ù…Ø§ Ù†Ù‡ØªÙ… Ø¨Ø§Ù„ÙØ¹Ù„ Ù†ÙØ³Ù‡ Ø£ÙƒØ«Ø± Ù…Ù† Ø§Ù„ÙØ§Ø¹Ù„.'
        }
      ]
    };

    /* ============================
       Ø¹Ù†Ø§ØµØ± DOM
       ============================ */

    const screens = {
      start: document.getElementById('start-screen'),
      loading: document.getElementById('loading-screen'),
      menu: document.getElementById('main-menu'),
      learning: document.getElementById('learning-area'),
      grammarLevels: document.getElementById('grammar-levels'),
      grammarLearning: document.getElementById('grammar-learning')
    };

    const displayText = document.getElementById('display-text');
    const subText = document.getElementById('sub-text');
    const modeLabel = document.getElementById('mode-label');
    const counterLabel = document.getElementById('counter-label');
    const toggleBtn = document.getElementById('toggle-btn');
    const toggleIcon = document.getElementById('toggle-icon');
    const toggleText = document.getElementById('toggle-text');
    const backBtn = document.getElementById('back-btn');
    const smartCycleBtn = document.getElementById('smart-cycle-btn');

    const grammarLevelLabel = document.getElementById('grammar-level-label');
    const grammarCounterLabel = document.getElementById('grammar-counter-label');
    const grammarTitle = document.getElementById('grammar-title');
    const grammarEn = document.getElementById('grammar-en');
    const grammarAr = document.getElementById('grammar-ar');
    const grammarToggleBtn = document.getElementById('grammar-toggle-btn');
    const grammarToggleIcon = document.getElementById('grammar-toggle-icon');
    const grammarToggleText = document.getElementById('grammar-toggle-text');

    let currentInterval = null;
    let currentMode = null;
    let currentIndex = 0;
    let isPlaying = true;
    let smartCycle = false;
    const modesOrder = ['abc', 'phonics', 'words', 'sentences'];

    let grammarInterval = null;
    let currentGrammarLevel = null;
    let currentGrammarIndex = 0;
    let grammarPlaying = true;

    /* ============================
       Ø§Ù„ØªÙ†Ù‚Ù„ Ø¨ÙŠÙ† Ø§Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©
       ============================ */

    function switchScreen(targetId) {
      Object.values(screens).forEach(s => {
        s.classList.remove('active-section');
        s.classList.add('hidden-section');
      });
      screens[targetId].classList.remove('hidden-section');
      screens[targetId].classList.add('active-section');

      if (targetId === 'learning' || targetId === 'grammarLearning') {
        backBtn.classList.add('show');
      } else {
        backBtn.classList.remove('show');
      }
    }

    function goToLoading() {
      switchScreen('loading');
      setTimeout(() => switchScreen('menu'), 5000);
    }

    /* ============================
       Ø²Ù…Ù† Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø°ÙƒÙŠ
       ============================ */

    function getSmartDelay(item) {
      const base = 2500;
      const extraPerChar = 80;
      const text = (item.en + ' ' + item.ar) || '';
      const length = text.length;
      let delay = base + length * extraPerChar;
      if (delay < 2500) delay = 2500;
      if (delay > 7000) delay = 7000;
      return delay;
    }

    /* ============================
       Ø­ÙØ¸ ÙˆØ§Ø³ØªØ±Ø¬Ø§Ø¹ Ø¢Ø®Ø± Ù…ÙˆØ¶Ø¹
       ============================ */

    function saveProgress() {
      if (!currentMode) return;
      localStorage.setItem('easyEnglish_progress_' + currentMode, currentIndex.toString());
    }

    function loadProgress(mode) {
      const val = localStorage.getItem('easyEnglish_progress_' + mode);
      if (!val) return 0;
      const num = parseInt(val, 10);
      if (isNaN(num)) return 0;
      const max = data[mode].length;
      return Math.min(Math.max(num, 0), max - 1);
    }

    /* ============================
       Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø¹Ø§Ù… (Ø­Ø±ÙˆÙ/Ø£ØµÙˆØ§Øª/ÙƒÙ„Ù…Ø§Øª/Ø¬Ù…Ù„)
       ============================ */

    function updateDisplay() {
      const list = data[currentMode];
      const item = list[currentIndex];

      displayText.style.opacity = 0;
      subText.style.opacity = 0;

      setTimeout(() => {
        displayText.textContent = item.en;
        subText.textContent = item.ar;
        displayText.style.opacity = 1;
        subText.style.opacity = 1;
      }, 200);

      const total = list.length;
      counterLabel.textContent = `${currentIndex + 1} / ${total}`;

      currentIndex = (currentIndex + 1) % total;
      saveProgress();

      if (smartCycle && currentIndex === 0) {
        const nextMode = getNextMode(currentMode);
        startLearning(nextMode, true);
      } else if (isPlaying) {
        const delay = getSmartDelay(item);
        clearTimeout(currentInterval);
        currentInterval = setTimeout(updateDisplay, delay);
      }
    }

    function getNextMode(mode) {
      const idx = modesOrder.indexOf(mode);
      if (idx === -1) return 'abc';
      return modesOrder[(idx + 1) % modesOrder.length];
    }

    function startAuto() {
      isPlaying = true;
      toggleIcon.textContent = 'â¸';
      toggleText.textContent = 'Ø¥ÙŠÙ‚Ø§Ù Ù…Ø¤Ù‚Øª';
      clearTimeout(currentInterval);
      const list = data[currentMode];
      const item = list[Math.max(currentIndex - 1, 0)];
      const delay = getSmartDelay(item || {en:'', ar:''});
      currentInterval = setTimeout(updateDisplay, delay);
    }

    function stopAuto() {
      isPlaying = false;
      toggleIcon.textContent = 'â–¶';
      toggleText.textContent = 'ØªØ´ØºÙŠÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠ';
      clearTimeout(currentInterval);
    }

    function startLearning(mode, fromSmartCycle = false) {
      currentMode = mode;
      currentIndex = loadProgress(mode);

      if (mode === 'abc') modeLabel.textContent = 'ÙˆØ¶Ø¹: Ø§Ù„Ø­Ø±ÙˆÙ';
      else if (mode === 'phonics') modeLabel.textContent = 'ÙˆØ¶Ø¹: Ø§Ù„Ø£ØµÙˆØ§Øª';
      else if (mode === 'words') modeLabel.textContent = 'ÙˆØ¶Ø¹: Ø§Ù„ÙƒÙ„Ù…Ø§Øª';
      else modeLabel.textContent = 'ÙˆØ¶Ø¹: Ø§Ù„Ø¬Ù…Ù„';

      switchScreen('learning');
      clearTimeout(currentInterval);
      isPlaying = true;
      toggleIcon.textContent = 'â¸';
      toggleText.textContent = 'Ø¥ÙŠÙ‚Ø§Ù Ù…Ø¤Ù‚Øª';
      updateDisplay();
    }

    function returnToMenu() {
      stopAuto();
      stopGrammarAuto();
      document.body.classList.remove('no-anim');
      switchScreen('menu');
    }

    toggleBtn.addEventListener('click', () => {
      if (isPlaying) stopAuto();
      else startAuto();
    });

    smartCycleBtn.addEventListener('click', () => {
      smartCycle = !smartCycle;
      if (smartCycle) {
        smartCycleBtn.textContent = 'Ø§Ù„ØªÙ†Ù‚Ù„ Ø§Ù„Ø°ÙƒÙŠ Ø¨ÙŠÙ† Ø§Ù„Ø£Ù‚Ø³Ø§Ù…: Ù…ÙØ¹Ù„';
        smartCycleBtn.classList.add('bg-white/10');
      } else {
        smartCycleBtn.textContent = 'ØªÙØ¹ÙŠÙ„ / Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØªÙ†Ù‚Ù„ Ø§Ù„Ø°ÙƒÙŠ Ø¨ÙŠÙ† Ø§Ù„Ø£Ù‚Ø³Ø§Ù…';
        smartCycleBtn.classList.remove('bg-white/10');
      }
    });

    document.addEventListener('visibilitychange', () => {
      if (document.hidden) {
        clearTimeout(currentInterval);
        clearTimeout(grammarInterval);
      } else {
        if (isPlaying && currentMode) startAuto();
        if (grammarPlaying && currentGrammarLevel) startGrammarAuto();
      }
    });

    /* ============================
       Ù‚Ø³Ù… Ø§Ù„Ù‚ÙˆØ§Ø¹Ø¯ (Grammar)
       ============================ */

    function openGrammar() {
      stopAuto();
      document.body.classList.add('no-anim');

      const tear = document.createElement('div');
      tear.className = 'page-tear';
      document.body.appendChild(tear);

      setTimeout(() => {
        document.body.removeChild(tear);
        switchScreen('grammarLevels');
      }, 1100);
    }

    function closeGrammar() {
      document.body.classList.remove('no-anim');
      switchScreen('menu');
    }

    function startGrammar(level) {
      currentGrammarLevel = level;
      currentGrammarIndex = 0;
      grammarPlaying = true;
      grammarToggleIcon.textContent = 'â¸';
      grammarToggleText.textContent = 'Ø¥ÙŠÙ‚Ø§Ù Ù…Ø¤Ù‚Øª';

      if (level === 'beginner') grammarLevelLabel.textContent = 'Ù‚ÙˆØ§Ø¹Ø¯: Ù…Ø¨ØªØ¯Ø¦';
      else if (level === 'intermediate') grammarLevelLabel.textContent = 'Ù‚ÙˆØ§Ø¹Ø¯: Ù…ØªÙˆØ³Ø·';
      else grammarLevelLabel.textContent = 'Ù‚ÙˆØ§Ø¹Ø¯: ØµØ¹Ø¨';

      switchScreen('grammarLearning');
      updateGrammarDisplay();
      startGrammarAuto();
    }

    function updateGrammarDisplay() {
      const list = grammarData[currentGrammarLevel];
      const item = list[currentGrammarIndex];

      grammarTitle.style.opacity = 0;
      grammarEn.style.opacity = 0;
      grammarAr.style.opacity = 0;

      setTimeout(() => {
        grammarTitle.textContent = item.title;
        grammarEn.textContent = item.en;
        grammarAr.textContent = item.ar;
        grammarTitle.style.opacity = 1;
        grammarEn.style.opacity = 1;
        grammarAr.style.opacity = 1;
      }, 150);

      const total = list.length;
      grammarCounterLabel.textContent = `${currentGrammarIndex + 1} / ${total}`;

      currentGrammarIndex = (currentGrammarIndex + 1) % total;
    }

    function getGrammarDelay(item) {
      const base = 3500;
      const extraPerChar = 60;
      const text = (item.title + ' ' + item.en + ' ' + item.ar) || '';
      let delay = base + text.length * extraPerChar;
      if (delay < 3500) delay = 3500;
      if (delay > 9000) delay = 9000;
      return delay;
    }

    function startGrammarAuto() {
      grammarPlaying = true;
      grammarToggleIcon.textContent = 'â¸';
      grammarToggleText.textContent = 'Ø¥ÙŠÙ‚Ø§Ù Ù…Ø¤Ù‚Øª';
      clearTimeout(grammarInterval);

      const list = grammarData[currentGrammarLevel];
      const item = list[Math.max(currentGrammarIndex - 1, 0)];
      const delay = getGrammarDelay(item || {title:'', en:'', ar:''});
      grammarInterval = setTimeout(() => {
        updateGrammarDisplay();
        startGrammarAuto();
      }, delay);
    }

    function stopGrammarAuto() {
      grammarPlaying = false;
      grammarToggleIcon.textContent = 'â–¶';
      grammarToggleText.textContent = 'ØªØ´ØºÙŠÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠ';
      clearTimeout(grammarInterval);
    }

    grammarToggleBtn.addEventListener('click', () => {
      if (grammarPlaying) stopGrammarAuto();
      else startGrammarAuto();
    });

    function backToGrammarLevels() {
      stopGrammarAuto();
      switchScreen('grammarLevels');
    }
  </script>
</body>
    </html>
